---
title: Подключение к SMTP-серверу
type: docs
weight: 10
url: /python-net/connecting-to-smtp-server/
---


## **Подключение к SMTP-серверу с поддержкой SSL**
При подключении к SMTP-серверу с поддержкой SSL необходимо установить следующие параметры:

- SecurityOptions
- Port

В приведенных ниже примерах мы показываем, как:

1. Установить имя пользователя.
1. Установить пароль.
1. Установить порт.
1. Установить параметр безопасности.

Следующий фрагмент кода показывает, как подключиться к SMTP-серверу с поддержкой SSL.

{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-SMTP-SSLEnabledSMTPServer-SSLEnabledSMTPServer.py" >}}

### **Установите тайм-аут для ответа сервера на приветствие**

Чтобы повысить эффективность работы почтового клиента, разработчики часто полагаются на свойство тайм-аута, чтобы ограничить время длительных процессов. Однако указание чрезмерно длинных интервалов для этого свойства может затруднить операции, требующие длительных временных промежутков обработки. Значительный пример — это установление соединения, когда полагание исключительно на свойство тайм-аута может привести к увеличению времени подключения.

В некоторых случаях почтовый клиент может использовать автоматический режим для установления соединения, систематически перебирая различные параметры соединения до тех пор, пока не будет установлено успешное соединение. SMTP, IMAP и POP3 серверы, после успешного инициирования соединения, отправляют строку приветствия клиенту. Как правило, серверы могут использовать либо неявные, либо явные (START TLS) методы инициации соединения SSL/TLS.

Проблема возникает, когда режим подключения не совпадает между сервером и клиентом. Например, если сервер ожидает неявное SSL-соединение, в то время как клиент пытается установить незащищенное или явно SSL-соединение, сервер воздерживается от отправки строки приветствия. В результате пользователи испытывают длительное время ожидания, пока не истечет тайм-аут, что заставляет клиента перейти к следующему варианту подключения.

Чтобы решить эту проблему, разработчики могут воспользоваться свойством 'greeting_timeout' класса [SmtpClient](https://reference.aspose.com/email/python-net/aspose.email.clients.smtp/smtpclient/#smtpclient-class). Это свойство позволяет установить тайм-аут (в миллисекундах) специально для строки приветствия, минимизируя время, необходимое для автоматического установления соединения. Внедрив свойство 'greeting_timeout', разработчики могут оптимизировать процессы соединения и обеспечить более отзывчивый и эффективный опыт почтового клиента.

Следующий образец кода демонстрирует, как внедрить это свойство в проект:

```py
import aspose.email as ae

client = ae.clients.smtp.SmtpClient("localhost", 25, "username", "password")
client.greeting_timeout = 4000
```
## **Отправка электронной почты через прокси-сервер SOCKS**

Aspose.Email поддерживает версии 4, 4a и 5 протокола прокси-сервера SOCKS. Следующий образец кода демонстрирует, как отправить электронное письмо с помощью SMTP с прокси-сервером SOCKS: 

```py
import aspose.email as ae

client = ae.clients.smtp.SmtpClient("smtp.domain.com", "username", "password")

client.security_options = ae.clients.SecurityOptions.SSL_IMPLICIT
# адрес прокси
proxy_address = "192.168.203.142"
# порт прокси
proxy_port = 1080
socks_proxy = ae.clients.SocksProxy(proxy_address, proxy_port, ae.clients.SocksVersion.SOCKS_V5)
client.proxy = socks_proxy
client.send(ae.MailMessage("sender@domain.com", "receiver@domain.com", "Отправка электронной почты через прокси", "Реализация протокола прокси-сервера SOCKS для версий 4, 4a, 5 (только аутентификация по имени пользователя/паролю)"))
```

## **Подключение к серверу через HTTP-прокси**

Следующий образец кода демонстрирует использование HTTP-прокси для отправки электронной почты через SMTP-сервер: 

```py
import aspose.email as ae

http_proxy = ae.clients.HttpProxy("18.222.124.59", 8080)
client = ae.clients.smtp.SmtpClient("host", 587, "username", "password")
client.proxy = http_proxy
client.send(ae.MailMessage("sender@domain.com", "receiver@domain.com", "Отправка электронной почты через прокси", "Тело"))
```

## **Подключение к серверу с использованием поддерживаемого метода аутентификации**

Для установки безопасного и успешного соединения с сервером для отправки электронной почты клиент может выбрать поддерживаемый метод аутентификации в зависимости от возможностей сервера. Aspose.Email предоставляет свойства, которые возвращают списки поддерживаемых методов аутентификации: 

- свойство 'supported_authentication' получает перечисление стран поддерживаемых сервером типов аутентификации 
- свойство 'allowed_authentication' получает или устанавливает перечисление типов аутентификации, разрешенных пользователем 

Используя эти свойства, разработчики могут обеспечить совместимость SMTP-клиента и сервера с точки зрения поддерживаемых методов аутентификации и установить соединение с SMTP-сервером. Следующий фрагмент кода предоставляет пример использования свойства 'allowed_authentication' в проекте:

```py
client.allowed_authentication = ae.clients.smtp.SmtpKnownAuthenticationType.LOGIN
```

## **Как установить тайм-аут для операций с почтой**

Установка тайм-аута может быть важна для эффективного управления сетевым взаимодействием. Свойство 'timeout' класса [SmtpClient](https://reference.aspose.com/email/python-net/aspose.email.clients.smtp/smtpclient/#smtpclient-class) используется для указания максимального времени (в миллисекундах) ожидания ответа от SMTP-сервера. Это свойство позволяет пользователю контролировать время, в течение которого клиент будет ожидать ответа от сервера на конкретную операцию, такую как подключение или отправка команды. Если сервер занимает больше времени, чем указано, для ответа, клиент выбросит исключение, указывая на ошибку тайм-аута. Это помогает в управлении поведением клиента при взаимодействии с сервером, обеспечивая, чтобы клиент не зависал бесконечно, если сервер не ответит вовремя. Используйте следующий фрагмент кода для установки тайм-аута для ответа сервера:

```py
import aspose.email as ae

client = ae.clients.smtp.SmtpClient("host", 587, "username", "password", ae.clients.SecurityOptions.SSL_EXPLICIT)
# 60 секунд
client.timeout = 60000
```

## **Использование криптографических протоколов с SMTP-клиентом**

Aspose.Email поддерживает SSL (устаревший) и TLS криптографические протоколы для обеспечения безопасности коммуникации. Вы можете включить криптографическое шифрование для защиты обмена данными между вашим приложением и почтовыми серверами.

```
ПРИМЕЧАНИЕ: Вы должны устанавливать только те версии протокола, которые поддерживаются Python Framework. Если некоторые версии криптографического протокола не поддерживаются вашей текущей версией Python Framework, они будут игнорироваться и пропущены. В этом случае исключения не будут сгенерированы. Пожалуйста, используйте метод 'set_supported_encryption_unsafe(value)' класса SmtpClient, если вы хотите установить протоколы без проверок совместимости.
```
Пример кода ниже показывает, как установить TLS 1.3 для экземпляра класса SmtpClient.

```py
import aspose.email as ae

client = ae.clients.smtp.SmtpClient("host", 587, "username", "password", ae.clients.SecurityOptions.SSL_EXPLICIT)
client.supported_encryption = ae.clients.base.EncryptionProtocols.TLS13
```

## **Использование механизма CRAM-MD5 для аутентификации**

Механизм аутентификации CRAM-MD5 Aspose.Email для Python предоставляет дополнительный уровень безопасности при доступе к серверу. Следующий фрагмент кода показывает, как внедрить эту функцию в ваш проект:

```py
client.allowed_authentication = ae.clients.smtp.SmtpKnownAuthenticationType.CRAM_MD5
```