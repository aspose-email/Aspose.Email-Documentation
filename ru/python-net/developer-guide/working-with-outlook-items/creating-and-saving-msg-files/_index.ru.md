---
title: "Создание и сохранение файлов MSG"
url: /ru/python-net/creating-and-saving-msg-files/
weight: 10
type: docs
---


Aspose.Email поддерживает создание файлов сообщений Outlook (MSG). В этой статье объясняется, как:

- Создать сообщения MSG.
- Создать сообщения MSG с вложениями.
- Создать сообщение MSG с телом в формате RTF.
- Сохранить сообщение как черновик.
- Работать с сжатием тела.
## **Создание и сохранение сообщений Outlook**
Класс MailMessage имеет метод Save(), который может сохранять файлы Outlook MSG на диск или в поток. Приведенные ниже фрагменты кода создают экземпляр класса MailMessage, устанавливают такие свойства, как from, to, subject и body. Метод Save() принимает имя файла в качестве аргумента. Кроме того, сообщения Outlook можно создавать с сжатым телом RTF, используя MapiConversionOptions. Для настройки создайте новое оконное приложение и добавьте ссылку на библиотеку Aspose.Email в проект.

1. Создайте новый экземпляр класса MailMessage и задайте свойства From, To, Subject и Body.
1. Вызовите метод FromMailMessage класса MailMessage, который принимает объект типа MailMessage. Метод FromMailMessage() конвертирует MailMessage в MailMessage (MSG).
1. Вызовите метод MapiMessage.Save() для сохранения файла MSG.

Напишите следующий код в событии нажатия кнопки управления оконным приложением.



{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-CreatingAndSavingOutlookMSG-CreatingAndSavingOutlookMSG.py" >}}
## **Создание файлов MSG с вложениями**
В приведенном выше примере мы создали простой файл MSG. Aspose.Email также поддерживает сохранение файлов сообщений с вложениями. Все, что вам нужно сделать, это добавить вложения к экземпляру MailMessage. Добавьте вложения, вызвав метод Add() у коллекции MailMessage.Attachments. Добавьте список на форму, созданную выше, и добавьте две кнопки, по одной для добавления и удаления вложений. Приложение, которое добавляет вложения, работает следующим образом:

1. Когда нажата кнопка **Добавить вложение**, отображается **Диалоговое окно открытия файла**, чтобы помочь пользователям просмотреть и выбрать вложение.
1. Когда файл выбран, полный путь добавляется в список.
1. Когда файл MSG создан, пути к вложениям извлекаются из списка и добавляются в коллекцию MailMessage.Attachments.

Напишите следующий код в событии нажатия кнопки **Добавить вложение**.



{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-AddingMSGAttachments-AddingMSGAttachments.py" >}}

Добавьте код для добавления вложений в экземпляр MailMessage. Финальный код функции Write Msg записан ниже.

{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-AddingMSGAttachments-AddingMSGAttachments.py" >}}


## **Создание файлов MSG с телом в формате RTF**
Вы также можете создать файлы сообщений Outlook (MSG) с телами в формате Rich Text (RTF) с помощью Aspose.Email. Тело в формате RTF поддерживает форматирование текста. Создайте его, установив свойство MailMessage.HtmlBody. Когда вы конвертируете экземпляр MailMessage в экземпляр MailMessage, HTML-тело преобразуется в RTF. Таким образом, форматирование тела электронной почты сохраняется.

Следующий пример создает файл MSG с телом в формате RTF. В заголовке применено жирное и подчеркивание форматирование в HTML-теле. Это форматирование сохраняется при конвертации HTML в RTF.



{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-CreatingMSGFilesWithRtfBody-CreatingMSGFilesWithRtfBody.py" >}}
## **Сохранение сообщения в черновом статусе**
Электронные письма сохраняются как черновики, когда кто-то начал редактировать их, но хочет вернуться к ним позже, чтобы завершить их. Aspose.Email поддерживает сохранение электронного письма в статусе черновика, устанавливая флаг сообщения. Ниже приведен пример кода для сохранения электронного письма Outlook (MSG) как черновика.



{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-SavingMessageInDraftStatus-SavingMessageInDraftStatus.py" >}}
## **Последствия сжатия тела**
Метод сжатия RTF тела можно использовать для генерации файлов MSG меньшего размера. Однако это приводит к снижению скорости. Для создания сообщений с улучшенной скоростью установите флаг в значение false. Этот флаг, в свою очередь, влияет на созданные PST: меньшие файлы MSG приводят к меньшим PST, а большие файлы MSG возвращают более медленное создание PST.



{{< gist "aspose-email" "356f0e128b9d45a7ee779fc813eb87e5" "Examples-WorkingWithOutlookMSGs-SetBodyCompression-SetBodyCompression.py" >}}



